#pragma once

#include "utils.h"

// qwen 0.6b
// #define NUM_TENSORS 311
// const size_t TOTAL_WEIGHTS_BYTES = 1503264768;

// qwen 8b
#define NUM_TENSORS 399
const size_t TOTAL_WEIGHTS_BYTES = 16381517208;

typedef struct TensorMetadata { 
    const char* name; 
    size_t offset; 
    size_t size_bytes; 
} TensorMetadata;

const TensorMetadata TENSOR_METADATA[NUM_TENSORS] = {
    // qwen 0.6b
    // {"lm_head.weight", 0, 311164928},
    // {"model.embed_tokens.weight", 311164928, 311164928},
    // {"model.layers.0.input_layernorm.weight", 622329856, 2048},
    // {"model.layers.0.mlp.down_proj.weight", 622331904, 6291456},
    // {"model.layers.0.mlp.gate_proj.weight", 628623360, 6291456},
    // {"model.layers.0.mlp.up_proj.weight", 634914816, 6291456},
    // {"model.layers.0.post_attention_layernorm.weight", 641206272, 2048},
    // {"model.layers.0.self_attn.k_norm.weight", 641208320, 256},
    // {"model.layers.0.self_attn.k_proj.weight", 641208576, 2097152},
    // {"model.layers.0.self_attn.o_proj.weight", 643305728, 4194304},
    // {"model.layers.0.self_attn.q_norm.weight", 647500032, 256},
    // {"model.layers.0.self_attn.q_proj.weight", 647500288, 4194304},
    // {"model.layers.0.self_attn.v_proj.weight", 651694592, 2097152},
    // {"model.layers.1.input_layernorm.weight", 653791744, 2048},
    // {"model.layers.1.mlp.down_proj.weight", 653793792, 6291456},
    // {"model.layers.1.mlp.gate_proj.weight", 660085248, 6291456},
    // {"model.layers.1.mlp.up_proj.weight", 666376704, 6291456},
    // {"model.layers.1.post_attention_layernorm.weight", 672668160, 2048},
    // {"model.layers.1.self_attn.k_norm.weight", 672670208, 256},
    // {"model.layers.1.self_attn.k_proj.weight", 672670464, 2097152},
    // {"model.layers.1.self_attn.o_proj.weight", 674767616, 4194304},
    // {"model.layers.1.self_attn.q_norm.weight", 678961920, 256},
    // {"model.layers.1.self_attn.q_proj.weight", 678962176, 4194304},
    // {"model.layers.1.self_attn.v_proj.weight", 683156480, 2097152},
    // {"model.layers.10.input_layernorm.weight", 685253632, 2048},
    // {"model.layers.10.mlp.down_proj.weight", 685255680, 6291456},
    // {"model.layers.10.mlp.gate_proj.weight", 691547136, 6291456},
    // {"model.layers.10.mlp.up_proj.weight", 697838592, 6291456},
    // {"model.layers.10.post_attention_layernorm.weight", 704130048, 2048},
    // {"model.layers.10.self_attn.k_norm.weight", 704132096, 256},
    // {"model.layers.10.self_attn.k_proj.weight", 704132352, 2097152},
    // {"model.layers.10.self_attn.o_proj.weight", 706229504, 4194304},
    // {"model.layers.10.self_attn.q_norm.weight", 710423808, 256},
    // {"model.layers.10.self_attn.q_proj.weight", 710424064, 4194304},
    // {"model.layers.10.self_attn.v_proj.weight", 714618368, 2097152},
    // {"model.layers.11.input_layernorm.weight", 716715520, 2048},
    // {"model.layers.11.mlp.down_proj.weight", 716717568, 6291456},
    // {"model.layers.11.mlp.gate_proj.weight", 723009024, 6291456},
    // {"model.layers.11.mlp.up_proj.weight", 729300480, 6291456},
    // {"model.layers.11.post_attention_layernorm.weight", 735591936, 2048},
    // {"model.layers.11.self_attn.k_norm.weight", 735593984, 256},
    // {"model.layers.11.self_attn.k_proj.weight", 735594240, 2097152},
    // {"model.layers.11.self_attn.o_proj.weight", 737691392, 4194304},
    // {"model.layers.11.self_attn.q_norm.weight", 741885696, 256},
    // {"model.layers.11.self_attn.q_proj.weight", 741885952, 4194304},
    // {"model.layers.11.self_attn.v_proj.weight", 746080256, 2097152},
    // {"model.layers.12.input_layernorm.weight", 748177408, 2048},
    // {"model.layers.12.mlp.down_proj.weight", 748179456, 6291456},
    // {"model.layers.12.mlp.gate_proj.weight", 754470912, 6291456},
    // {"model.layers.12.mlp.up_proj.weight", 760762368, 6291456},
    // {"model.layers.12.post_attention_layernorm.weight", 767053824, 2048},
    // {"model.layers.12.self_attn.k_norm.weight", 767055872, 256},
    // {"model.layers.12.self_attn.k_proj.weight", 767056128, 2097152},
    // {"model.layers.12.self_attn.o_proj.weight", 769153280, 4194304},
    // {"model.layers.12.self_attn.q_norm.weight", 773347584, 256},
    // {"model.layers.12.self_attn.q_proj.weight", 773347840, 4194304},
    // {"model.layers.12.self_attn.v_proj.weight", 777542144, 2097152},
    // {"model.layers.13.input_layernorm.weight", 779639296, 2048},
    // {"model.layers.13.mlp.down_proj.weight", 779641344, 6291456},
    // {"model.layers.13.mlp.gate_proj.weight", 785932800, 6291456},
    // {"model.layers.13.mlp.up_proj.weight", 792224256, 6291456},
    // {"model.layers.13.post_attention_layernorm.weight", 798515712, 2048},
    // {"model.layers.13.self_attn.k_norm.weight", 798517760, 256},
    // {"model.layers.13.self_attn.k_proj.weight", 798518016, 2097152},
    // {"model.layers.13.self_attn.o_proj.weight", 800615168, 4194304},
    // {"model.layers.13.self_attn.q_norm.weight", 804809472, 256},
    // {"model.layers.13.self_attn.q_proj.weight", 804809728, 4194304},
    // {"model.layers.13.self_attn.v_proj.weight", 809004032, 2097152},
    // {"model.layers.14.input_layernorm.weight", 811101184, 2048},
    // {"model.layers.14.mlp.down_proj.weight", 811103232, 6291456},
    // {"model.layers.14.mlp.gate_proj.weight", 817394688, 6291456},
    // {"model.layers.14.mlp.up_proj.weight", 823686144, 6291456},
    // {"model.layers.14.post_attention_layernorm.weight", 829977600, 2048},
    // {"model.layers.14.self_attn.k_norm.weight", 829979648, 256},
    // {"model.layers.14.self_attn.k_proj.weight", 829979904, 2097152},
    // {"model.layers.14.self_attn.o_proj.weight", 832077056, 4194304},
    // {"model.layers.14.self_attn.q_norm.weight", 836271360, 256},
    // {"model.layers.14.self_attn.q_proj.weight", 836271616, 4194304},
    // {"model.layers.14.self_attn.v_proj.weight", 840465920, 2097152},
    // {"model.layers.15.input_layernorm.weight", 842563072, 2048},
    // {"model.layers.15.mlp.down_proj.weight", 842565120, 6291456},
    // {"model.layers.15.mlp.gate_proj.weight", 848856576, 6291456},
    // {"model.layers.15.mlp.up_proj.weight", 855148032, 6291456},
    // {"model.layers.15.post_attention_layernorm.weight", 861439488, 2048},
    // {"model.layers.15.self_attn.k_norm.weight", 861441536, 256},
    // {"model.layers.15.self_attn.k_proj.weight", 861441792, 2097152},
    // {"model.layers.15.self_attn.o_proj.weight", 863538944, 4194304},
    // {"model.layers.15.self_attn.q_norm.weight", 867733248, 256},
    // {"model.layers.15.self_attn.q_proj.weight", 867733504, 4194304},
    // {"model.layers.15.self_attn.v_proj.weight", 871927808, 2097152},
    // {"model.layers.16.input_layernorm.weight", 874024960, 2048},
    // {"model.layers.16.mlp.down_proj.weight", 874027008, 6291456},
    // {"model.layers.16.mlp.gate_proj.weight", 880318464, 6291456},
    // {"model.layers.16.mlp.up_proj.weight", 886609920, 6291456},
    // {"model.layers.16.post_attention_layernorm.weight", 892901376, 2048},
    // {"model.layers.16.self_attn.k_norm.weight", 892903424, 256},
    // {"model.layers.16.self_attn.k_proj.weight", 892903680, 2097152},
    // {"model.layers.16.self_attn.o_proj.weight", 895000832, 4194304},
    // {"model.layers.16.self_attn.q_norm.weight", 899195136, 256},
    // {"model.layers.16.self_attn.q_proj.weight", 899195392, 4194304},
    // {"model.layers.16.self_attn.v_proj.weight", 903389696, 2097152},
    // {"model.layers.17.input_layernorm.weight", 905486848, 2048},
    // {"model.layers.17.mlp.down_proj.weight", 905488896, 6291456},
    // {"model.layers.17.mlp.gate_proj.weight", 911780352, 6291456},
    // {"model.layers.17.mlp.up_proj.weight", 918071808, 6291456},
    // {"model.layers.17.post_attention_layernorm.weight", 924363264, 2048},
    // {"model.layers.17.self_attn.k_norm.weight", 924365312, 256},
    // {"model.layers.17.self_attn.k_proj.weight", 924365568, 2097152},
    // {"model.layers.17.self_attn.o_proj.weight", 926462720, 4194304},
    // {"model.layers.17.self_attn.q_norm.weight", 930657024, 256},
    // {"model.layers.17.self_attn.q_proj.weight", 930657280, 4194304},
    // {"model.layers.17.self_attn.v_proj.weight", 934851584, 2097152},
    // {"model.layers.18.input_layernorm.weight", 936948736, 2048},
    // {"model.layers.18.mlp.down_proj.weight", 936950784, 6291456},
    // {"model.layers.18.mlp.gate_proj.weight", 943242240, 6291456},
    // {"model.layers.18.mlp.up_proj.weight", 949533696, 6291456},
    // {"model.layers.18.post_attention_layernorm.weight", 955825152, 2048},
    // {"model.layers.18.self_attn.k_norm.weight", 955827200, 256},
    // {"model.layers.18.self_attn.k_proj.weight", 955827456, 2097152},
    // {"model.layers.18.self_attn.o_proj.weight", 957924608, 4194304},
    // {"model.layers.18.self_attn.q_norm.weight", 962118912, 256},
    // {"model.layers.18.self_attn.q_proj.weight", 962119168, 4194304},
    // {"model.layers.18.self_attn.v_proj.weight", 966313472, 2097152},
    // {"model.layers.19.input_layernorm.weight", 968410624, 2048},
    // {"model.layers.19.mlp.down_proj.weight", 968412672, 6291456},
    // {"model.layers.19.mlp.gate_proj.weight", 974704128, 6291456},
    // {"model.layers.19.mlp.up_proj.weight", 980995584, 6291456},
    // {"model.layers.19.post_attention_layernorm.weight", 987287040, 2048},
    // {"model.layers.19.self_attn.k_norm.weight", 987289088, 256},
    // {"model.layers.19.self_attn.k_proj.weight", 987289344, 2097152},
    // {"model.layers.19.self_attn.o_proj.weight", 989386496, 4194304},
    // {"model.layers.19.self_attn.q_norm.weight", 993580800, 256},
    // {"model.layers.19.self_attn.q_proj.weight", 993581056, 4194304},
    // {"model.layers.19.self_attn.v_proj.weight", 997775360, 2097152},
    // {"model.layers.2.input_layernorm.weight", 999872512, 2048},
    // {"model.layers.2.mlp.down_proj.weight", 999874560, 6291456},
    // {"model.layers.2.mlp.gate_proj.weight", 1006166016, 6291456},
    // {"model.layers.2.mlp.up_proj.weight", 1012457472, 6291456},
    // {"model.layers.2.post_attention_layernorm.weight", 1018748928, 2048},
    // {"model.layers.2.self_attn.k_norm.weight", 1018750976, 256},
    // {"model.layers.2.self_attn.k_proj.weight", 1018751232, 2097152},
    // {"model.layers.2.self_attn.o_proj.weight", 1020848384, 4194304},
    // {"model.layers.2.self_attn.q_norm.weight", 1025042688, 256},
    // {"model.layers.2.self_attn.q_proj.weight", 1025042944, 4194304},
    // {"model.layers.2.self_attn.v_proj.weight", 1029237248, 2097152},
    // {"model.layers.20.input_layernorm.weight", 1031334400, 2048},
    // {"model.layers.20.mlp.down_proj.weight", 1031336448, 6291456},
    // {"model.layers.20.mlp.gate_proj.weight", 1037627904, 6291456},
    // {"model.layers.20.mlp.up_proj.weight", 1043919360, 6291456},
    // {"model.layers.20.post_attention_layernorm.weight", 1050210816, 2048},
    // {"model.layers.20.self_attn.k_norm.weight", 1050212864, 256},
    // {"model.layers.20.self_attn.k_proj.weight", 1050213120, 2097152},
    // {"model.layers.20.self_attn.o_proj.weight", 1052310272, 4194304},
    // {"model.layers.20.self_attn.q_norm.weight", 1056504576, 256},
    // {"model.layers.20.self_attn.q_proj.weight", 1056504832, 4194304},
    // {"model.layers.20.self_attn.v_proj.weight", 1060699136, 2097152},
    // {"model.layers.21.input_layernorm.weight", 1062796288, 2048},
    // {"model.layers.21.mlp.down_proj.weight", 1062798336, 6291456},
    // {"model.layers.21.mlp.gate_proj.weight", 1069089792, 6291456},
    // {"model.layers.21.mlp.up_proj.weight", 1075381248, 6291456},
    // {"model.layers.21.post_attention_layernorm.weight", 1081672704, 2048},
    // {"model.layers.21.self_attn.k_norm.weight", 1081674752, 256},
    // {"model.layers.21.self_attn.k_proj.weight", 1081675008, 2097152},
    // {"model.layers.21.self_attn.o_proj.weight", 1083772160, 4194304},
    // {"model.layers.21.self_attn.q_norm.weight", 1087966464, 256},
    // {"model.layers.21.self_attn.q_proj.weight", 1087966720, 4194304},
    // {"model.layers.21.self_attn.v_proj.weight", 1092161024, 2097152},
    // {"model.layers.22.input_layernorm.weight", 1094258176, 2048},
    // {"model.layers.22.mlp.down_proj.weight", 1094260224, 6291456},
    // {"model.layers.22.mlp.gate_proj.weight", 1100551680, 6291456},
    // {"model.layers.22.mlp.up_proj.weight", 1106843136, 6291456},
    // {"model.layers.22.post_attention_layernorm.weight", 1113134592, 2048},
    // {"model.layers.22.self_attn.k_norm.weight", 1113136640, 256},
    // {"model.layers.22.self_attn.k_proj.weight", 1113136896, 2097152},
    // {"model.layers.22.self_attn.o_proj.weight", 1115234048, 4194304},
    // {"model.layers.22.self_attn.q_norm.weight", 1119428352, 256},
    // {"model.layers.22.self_attn.q_proj.weight", 1119428608, 4194304},
    // {"model.layers.22.self_attn.v_proj.weight", 1123622912, 2097152},
    // {"model.layers.23.input_layernorm.weight", 1125720064, 2048},
    // {"model.layers.23.mlp.down_proj.weight", 1125722112, 6291456},
    // {"model.layers.23.mlp.gate_proj.weight", 1132013568, 6291456},
    // {"model.layers.23.mlp.up_proj.weight", 1138305024, 6291456},
    // {"model.layers.23.post_attention_layernorm.weight", 1144596480, 2048},
    // {"model.layers.23.self_attn.k_norm.weight", 1144598528, 256},
    // {"model.layers.23.self_attn.k_proj.weight", 1144598784, 2097152},
    // {"model.layers.23.self_attn.o_proj.weight", 1146695936, 4194304},
    // {"model.layers.23.self_attn.q_norm.weight", 1150890240, 256},
    // {"model.layers.23.self_attn.q_proj.weight", 1150890496, 4194304},
    // {"model.layers.23.self_attn.v_proj.weight", 1155084800, 2097152},
    // {"model.layers.24.input_layernorm.weight", 1157181952, 2048},
    // {"model.layers.24.mlp.down_proj.weight", 1157184000, 6291456},
    // {"model.layers.24.mlp.gate_proj.weight", 1163475456, 6291456},
    // {"model.layers.24.mlp.up_proj.weight", 1169766912, 6291456},
    // {"model.layers.24.post_attention_layernorm.weight", 1176058368, 2048},
    // {"model.layers.24.self_attn.k_norm.weight", 1176060416, 256},
    // {"model.layers.24.self_attn.k_proj.weight", 1176060672, 2097152},
    // {"model.layers.24.self_attn.o_proj.weight", 1178157824, 4194304},
    // {"model.layers.24.self_attn.q_norm.weight", 1182352128, 256},
    // {"model.layers.24.self_attn.q_proj.weight", 1182352384, 4194304},
    // {"model.layers.24.self_attn.v_proj.weight", 1186546688, 2097152},
    // {"model.layers.25.input_layernorm.weight", 1188643840, 2048},
    // {"model.layers.25.mlp.down_proj.weight", 1188645888, 6291456},
    // {"model.layers.25.mlp.gate_proj.weight", 1194937344, 6291456},
    // {"model.layers.25.mlp.up_proj.weight", 1201228800, 6291456},
    // {"model.layers.25.post_attention_layernorm.weight", 1207520256, 2048},
    // {"model.layers.25.self_attn.k_norm.weight", 1207522304, 256},
    // {"model.layers.25.self_attn.k_proj.weight", 1207522560, 2097152},
    // {"model.layers.25.self_attn.o_proj.weight", 1209619712, 4194304},
    // {"model.layers.25.self_attn.q_norm.weight", 1213814016, 256},
    // {"model.layers.25.self_attn.q_proj.weight", 1213814272, 4194304},
    // {"model.layers.25.self_attn.v_proj.weight", 1218008576, 2097152},
    // {"model.layers.26.input_layernorm.weight", 1220105728, 2048},
    // {"model.layers.26.mlp.down_proj.weight", 1220107776, 6291456},
    // {"model.layers.26.mlp.gate_proj.weight", 1226399232, 6291456},
    // {"model.layers.26.mlp.up_proj.weight", 1232690688, 6291456},
    // {"model.layers.26.post_attention_layernorm.weight", 1238982144, 2048},
    // {"model.layers.26.self_attn.k_norm.weight", 1238984192, 256},
    // {"model.layers.26.self_attn.k_proj.weight", 1238984448, 2097152},
    // {"model.layers.26.self_attn.o_proj.weight", 1241081600, 4194304},
    // {"model.layers.26.self_attn.q_norm.weight", 1245275904, 256},
    // {"model.layers.26.self_attn.q_proj.weight", 1245276160, 4194304},
    // {"model.layers.26.self_attn.v_proj.weight", 1249470464, 2097152},
    // {"model.layers.27.input_layernorm.weight", 1251567616, 2048},
    // {"model.layers.27.mlp.down_proj.weight", 1251569664, 6291456},
    // {"model.layers.27.mlp.gate_proj.weight", 1257861120, 6291456},
    // {"model.layers.27.mlp.up_proj.weight", 1264152576, 6291456},
    // {"model.layers.27.post_attention_layernorm.weight", 1270444032, 2048},
    // {"model.layers.27.self_attn.k_norm.weight", 1270446080, 256},
    // {"model.layers.27.self_attn.k_proj.weight", 1270446336, 2097152},
    // {"model.layers.27.self_attn.o_proj.weight", 1272543488, 4194304},
    // {"model.layers.27.self_attn.q_norm.weight", 1276737792, 256},
    // {"model.layers.27.self_attn.q_proj.weight", 1276738048, 4194304},
    // {"model.layers.27.self_attn.v_proj.weight", 1280932352, 2097152},
    // {"model.layers.3.input_layernorm.weight", 1283029504, 2048},
    // {"model.layers.3.mlp.down_proj.weight", 1283031552, 6291456},
    // {"model.layers.3.mlp.gate_proj.weight", 1289323008, 6291456},
    // {"model.layers.3.mlp.up_proj.weight", 1295614464, 6291456},
    // {"model.layers.3.post_attention_layernorm.weight", 1301905920, 2048},
    // {"model.layers.3.self_attn.k_norm.weight", 1301907968, 256},
    // {"model.layers.3.self_attn.k_proj.weight", 1301908224, 2097152},
    // {"model.layers.3.self_attn.o_proj.weight", 1304005376, 4194304},
    // {"model.layers.3.self_attn.q_norm.weight", 1308199680, 256},
    // {"model.layers.3.self_attn.q_proj.weight", 1308199936, 4194304},
    // {"model.layers.3.self_attn.v_proj.weight", 1312394240, 2097152},
    // {"model.layers.4.input_layernorm.weight", 1314491392, 2048},
    // {"model.layers.4.mlp.down_proj.weight", 1314493440, 6291456},
    // {"model.layers.4.mlp.gate_proj.weight", 1320784896, 6291456},
    // {"model.layers.4.mlp.up_proj.weight", 1327076352, 6291456},
    // {"model.layers.4.post_attention_layernorm.weight", 1333367808, 2048},
    // {"model.layers.4.self_attn.k_norm.weight", 1333369856, 256},
    // {"model.layers.4.self_attn.k_proj.weight", 1333370112, 2097152},
    // {"model.layers.4.self_attn.o_proj.weight", 1335467264, 4194304},
    // {"model.layers.4.self_attn.q_norm.weight", 1339661568, 256},
    // {"model.layers.4.self_attn.q_proj.weight", 1339661824, 4194304},
    // {"model.layers.4.self_attn.v_proj.weight", 1343856128, 2097152},
    // {"model.layers.5.input_layernorm.weight", 1345953280, 2048},
    // {"model.layers.5.mlp.down_proj.weight", 1345955328, 6291456},
    // {"model.layers.5.mlp.gate_proj.weight", 1352246784, 6291456},
    // {"model.layers.5.mlp.up_proj.weight", 1358538240, 6291456},
    // {"model.layers.5.post_attention_layernorm.weight", 1364829696, 2048},
    // {"model.layers.5.self_attn.k_norm.weight", 1364831744, 256},
    // {"model.layers.5.self_attn.k_proj.weight", 1364832000, 2097152},
    // {"model.layers.5.self_attn.o_proj.weight", 1366929152, 4194304},
    // {"model.layers.5.self_attn.q_norm.weight", 1371123456, 256},
    // {"model.layers.5.self_attn.q_proj.weight", 1371123712, 4194304},
    // {"model.layers.5.self_attn.v_proj.weight", 1375318016, 2097152},
    // {"model.layers.6.input_layernorm.weight", 1377415168, 2048},
    // {"model.layers.6.mlp.down_proj.weight", 1377417216, 6291456},
    // {"model.layers.6.mlp.gate_proj.weight", 1383708672, 6291456},
    // {"model.layers.6.mlp.up_proj.weight", 1390000128, 6291456},
    // {"model.layers.6.post_attention_layernorm.weight", 1396291584, 2048},
    // {"model.layers.6.self_attn.k_norm.weight", 1396293632, 256},
    // {"model.layers.6.self_attn.k_proj.weight", 1396293888, 2097152},
    // {"model.layers.6.self_attn.o_proj.weight", 1398391040, 4194304},
    // {"model.layers.6.self_attn.q_norm.weight", 1402585344, 256},
    // {"model.layers.6.self_attn.q_proj.weight", 1402585600, 4194304},
    // {"model.layers.6.self_attn.v_proj.weight", 1406779904, 2097152},
    // {"model.layers.7.input_layernorm.weight", 1408877056, 2048},
    // {"model.layers.7.mlp.down_proj.weight", 1408879104, 6291456},
    // {"model.layers.7.mlp.gate_proj.weight", 1415170560, 6291456},
    // {"model.layers.7.mlp.up_proj.weight", 1421462016, 6291456},
    // {"model.layers.7.post_attention_layernorm.weight", 1427753472, 2048},
    // {"model.layers.7.self_attn.k_norm.weight", 1427755520, 256},
    // {"model.layers.7.self_attn.k_proj.weight", 1427755776, 2097152},
    // {"model.layers.7.self_attn.o_proj.weight", 1429852928, 4194304},
    // {"model.layers.7.self_attn.q_norm.weight", 1434047232, 256},
    // {"model.layers.7.self_attn.q_proj.weight", 1434047488, 4194304},
    // {"model.layers.7.self_attn.v_proj.weight", 1438241792, 2097152},
    // {"model.layers.8.input_layernorm.weight", 1440338944, 2048},
    // {"model.layers.8.mlp.down_proj.weight", 1440340992, 6291456},
    // {"model.layers.8.mlp.gate_proj.weight", 1446632448, 6291456},
    // {"model.layers.8.mlp.up_proj.weight", 1452923904, 6291456},
    // {"model.layers.8.post_attention_layernorm.weight", 1459215360, 2048},
    // {"model.layers.8.self_attn.k_norm.weight", 1459217408, 256},
    // {"model.layers.8.self_attn.k_proj.weight", 1459217664, 2097152},
    // {"model.layers.8.self_attn.o_proj.weight", 1461314816, 4194304},
    // {"model.layers.8.self_attn.q_norm.weight", 1465509120, 256},
    // {"model.layers.8.self_attn.q_proj.weight", 1465509376, 4194304},
    // {"model.layers.8.self_attn.v_proj.weight", 1469703680, 2097152},
    // {"model.layers.9.input_layernorm.weight", 1471800832, 2048},
    // {"model.layers.9.mlp.down_proj.weight", 1471802880, 6291456},
    // {"model.layers.9.mlp.gate_proj.weight", 1478094336, 6291456},
    // {"model.layers.9.mlp.up_proj.weight", 1484385792, 6291456},
    // {"model.layers.9.post_attention_layernorm.weight", 1490677248, 2048},
    // {"model.layers.9.self_attn.k_norm.weight", 1490679296, 256},
    // {"model.layers.9.self_attn.k_proj.weight", 1490679552, 2097152},
    // {"model.layers.9.self_attn.o_proj.weight", 1492776704, 4194304},
    // {"model.layers.9.self_attn.q_norm.weight", 1496971008, 256},
    // {"model.layers.9.self_attn.q_proj.weight", 1496971264, 4194304},
    // {"model.layers.9.self_attn.v_proj.weight", 1501165568, 2097152},
    // {"model.norm.weight", 1503262720, 2048},

    // qwen-8b
    {"lm_head.weight", 0, 1244659712},
    {"model.embed_tokens.weight", 1244659712, 1244659712},
    {"model.layers.0.input_layernorm.weight", 2489319424, 8192},
    {"model.layers.0.mlp.down_proj.weight", 2489327616, 100663296},
    {"model.layers.0.mlp.gate_proj.weight", 2589990912, 100663296},
    {"model.layers.0.mlp.up_proj.weight", 2690654208, 100663296},
    {"model.layers.0.post_attention_layernorm.weight", 2791317504, 8192},
    {"model.layers.0.self_attn.k_norm.weight", 2791325696, 256},
    {"model.layers.0.self_attn.k_proj.weight", 2791325952, 8388608},
    {"model.layers.0.self_attn.o_proj.weight", 2799714560, 33554432},
    {"model.layers.0.self_attn.q_norm.weight", 2833268992, 256},
    {"model.layers.0.self_attn.q_proj.weight", 2833269248, 33554432},
    {"model.layers.0.self_attn.v_proj.weight", 2866823680, 8388608},
    {"model.layers.1.input_layernorm.weight", 2875212288, 8192},
    {"model.layers.1.mlp.down_proj.weight", 2875220480, 100663296},
    {"model.layers.1.mlp.gate_proj.weight", 2975883776, 100663296},
    {"model.layers.1.mlp.up_proj.weight", 3076547072, 100663296},
    {"model.layers.1.post_attention_layernorm.weight", 3177210368, 8192},
    {"model.layers.1.self_attn.k_norm.weight", 3177218560, 256},
    {"model.layers.1.self_attn.k_proj.weight", 3177218816, 8388608},
    {"model.layers.1.self_attn.o_proj.weight", 3185607424, 33554432},
    {"model.layers.1.self_attn.q_norm.weight", 3219161856, 256},
    {"model.layers.1.self_attn.q_proj.weight", 3219162112, 33554432},
    {"model.layers.1.self_attn.v_proj.weight", 3252716544, 8388608},
    {"model.layers.10.input_layernorm.weight", 3261105152, 8192},
    {"model.layers.10.mlp.down_proj.weight", 3261113344, 100663296},
    {"model.layers.10.mlp.gate_proj.weight", 3361776640, 100663296},
    {"model.layers.10.mlp.up_proj.weight", 3462439936, 100663296},
    {"model.layers.10.post_attention_layernorm.weight", 3563103232, 8192},
    {"model.layers.10.self_attn.k_norm.weight", 3563111424, 256},
    {"model.layers.10.self_attn.k_proj.weight", 3563111680, 8388608},
    {"model.layers.10.self_attn.o_proj.weight", 3571500288, 33554432},
    {"model.layers.10.self_attn.q_norm.weight", 3605054720, 256},
    {"model.layers.10.self_attn.q_proj.weight", 3605054976, 33554432},
    {"model.layers.10.self_attn.v_proj.weight", 3638609408, 8388608},
    {"model.layers.11.input_layernorm.weight", 3646998016, 8192},
    {"model.layers.11.mlp.down_proj.weight", 3647006208, 100663296},
    {"model.layers.11.mlp.gate_proj.weight", 3747669504, 100663296},
    {"model.layers.11.mlp.up_proj.weight", 3848332800, 100663296},
    {"model.layers.11.post_attention_layernorm.weight", 3948996096, 8192},
    {"model.layers.11.self_attn.k_norm.weight", 3949004288, 256},
    {"model.layers.11.self_attn.k_proj.weight", 3949004544, 8388608},
    {"model.layers.11.self_attn.o_proj.weight", 3957393152, 33554432},
    {"model.layers.11.self_attn.q_norm.weight", 3990947584, 256},
    {"model.layers.11.self_attn.q_proj.weight", 3990947840, 33554432},
    {"model.layers.11.self_attn.v_proj.weight", 4024502272, 8388608},
    {"model.layers.12.input_layernorm.weight", 4032890880, 8192},
    {"model.layers.12.mlp.down_proj.weight", 4032899072, 100663296},
    {"model.layers.12.mlp.gate_proj.weight", 4133562368, 100663296},
    {"model.layers.12.mlp.up_proj.weight", 4234225664, 100663296},
    {"model.layers.12.post_attention_layernorm.weight", 4334888960, 8192},
    {"model.layers.12.self_attn.k_norm.weight", 4334897152, 256},
    {"model.layers.12.self_attn.k_proj.weight", 4334897408, 8388608},
    {"model.layers.12.self_attn.o_proj.weight", 4343286016, 33554432},
    {"model.layers.12.self_attn.q_norm.weight", 4376840448, 256},
    {"model.layers.12.self_attn.q_proj.weight", 4376840704, 33554432},
    {"model.layers.12.self_attn.v_proj.weight", 4410395136, 8388608},
    {"model.layers.13.input_layernorm.weight", 4418783744, 8192},
    {"model.layers.13.mlp.down_proj.weight", 4418791936, 100663296},
    {"model.layers.13.mlp.gate_proj.weight", 4519455232, 100663296},
    {"model.layers.13.mlp.up_proj.weight", 4620118528, 100663296},
    {"model.layers.13.post_attention_layernorm.weight", 4720781824, 8192},
    {"model.layers.13.self_attn.k_norm.weight", 4720790016, 256},
    {"model.layers.13.self_attn.k_proj.weight", 4720790272, 8388608},
    {"model.layers.13.self_attn.o_proj.weight", 4729178880, 33554432},
    {"model.layers.13.self_attn.q_norm.weight", 4762733312, 256},
    {"model.layers.13.self_attn.q_proj.weight", 4762733568, 33554432},
    {"model.layers.13.self_attn.v_proj.weight", 4796288000, 8388608},
    {"model.layers.14.input_layernorm.weight", 4804676608, 8192},
    {"model.layers.14.mlp.down_proj.weight", 4804684800, 100663296},
    {"model.layers.14.mlp.gate_proj.weight", 4905348096, 100663296},
    {"model.layers.14.mlp.up_proj.weight", 5006011392, 100663296},
    {"model.layers.14.post_attention_layernorm.weight", 5106674688, 8192},
    {"model.layers.14.self_attn.k_norm.weight", 5106682880, 256},
    {"model.layers.14.self_attn.k_proj.weight", 5106683136, 8388608},
    {"model.layers.14.self_attn.o_proj.weight", 5115071744, 33554432},
    {"model.layers.14.self_attn.q_norm.weight", 5148626176, 256},
    {"model.layers.14.self_attn.q_proj.weight", 5148626432, 33554432},
    {"model.layers.14.self_attn.v_proj.weight", 5182180864, 8388608},
    {"model.layers.15.input_layernorm.weight", 5190569472, 8192},
    {"model.layers.15.mlp.down_proj.weight", 5190577664, 100663296},
    {"model.layers.15.mlp.gate_proj.weight", 5291240960, 100663296},
    {"model.layers.15.mlp.up_proj.weight", 5391904256, 100663296},
    {"model.layers.15.post_attention_layernorm.weight", 5492567552, 8192},
    {"model.layers.15.self_attn.k_norm.weight", 5492575744, 256},
    {"model.layers.15.self_attn.k_proj.weight", 5492576000, 8388608},
    {"model.layers.15.self_attn.o_proj.weight", 5500964608, 33554432},
    {"model.layers.15.self_attn.q_norm.weight", 5534519040, 256},
    {"model.layers.15.self_attn.q_proj.weight", 5534519296, 33554432},
    {"model.layers.15.self_attn.v_proj.weight", 5568073728, 8388608},
    {"model.layers.16.input_layernorm.weight", 5576462336, 8192},
    {"model.layers.16.mlp.down_proj.weight", 5576470528, 100663296},
    {"model.layers.16.mlp.gate_proj.weight", 5677133824, 100663296},
    {"model.layers.16.mlp.up_proj.weight", 5777797120, 100663296},
    {"model.layers.16.post_attention_layernorm.weight", 5878460416, 8192},
    {"model.layers.16.self_attn.k_norm.weight", 5878468608, 256},
    {"model.layers.16.self_attn.k_proj.weight", 5878468864, 8388608},
    {"model.layers.16.self_attn.o_proj.weight", 5886857472, 33554432},
    {"model.layers.16.self_attn.q_norm.weight", 5920411904, 256},
    {"model.layers.16.self_attn.q_proj.weight", 5920412160, 33554432},
    {"model.layers.16.self_attn.v_proj.weight", 5953966592, 8388608},
    {"model.layers.17.input_layernorm.weight", 5962355200, 8192},
    {"model.layers.17.mlp.down_proj.weight", 5962363392, 100663296},
    {"model.layers.17.mlp.gate_proj.weight", 6063026688, 100663296},
    {"model.layers.17.mlp.up_proj.weight", 6163689984, 100663296},
    {"model.layers.17.post_attention_layernorm.weight", 6264353280, 8192},
    {"model.layers.17.self_attn.k_norm.weight", 6264361472, 256},
    {"model.layers.17.self_attn.k_proj.weight", 6264361728, 8388608},
    {"model.layers.17.self_attn.o_proj.weight", 6272750336, 33554432},
    {"model.layers.17.self_attn.q_norm.weight", 6306304768, 256},
    {"model.layers.17.self_attn.q_proj.weight", 6306305024, 33554432},
    {"model.layers.17.self_attn.v_proj.weight", 6339859456, 8388608},
    {"model.layers.18.input_layernorm.weight", 6348248064, 8192},
    {"model.layers.18.mlp.down_proj.weight", 6348256256, 100663296},
    {"model.layers.18.mlp.gate_proj.weight", 6448919552, 100663296},
    {"model.layers.18.mlp.up_proj.weight", 6549582848, 100663296},
    {"model.layers.18.post_attention_layernorm.weight", 6650246144, 8192},
    {"model.layers.18.self_attn.k_norm.weight", 6650254336, 256},
    {"model.layers.18.self_attn.k_proj.weight", 6650254592, 8388608},
    {"model.layers.18.self_attn.o_proj.weight", 6658643200, 33554432},
    {"model.layers.18.self_attn.q_norm.weight", 6692197632, 256},
    {"model.layers.18.self_attn.q_proj.weight", 6692197888, 33554432},
    {"model.layers.18.self_attn.v_proj.weight", 6725752320, 8388608},
    {"model.layers.19.input_layernorm.weight", 6734140928, 8192},
    {"model.layers.19.mlp.down_proj.weight", 6734149120, 100663296},
    {"model.layers.19.mlp.gate_proj.weight", 6834812416, 100663296},
    {"model.layers.19.mlp.up_proj.weight", 6935475712, 100663296},
    {"model.layers.19.post_attention_layernorm.weight", 7036139008, 8192},
    {"model.layers.19.self_attn.k_norm.weight", 7036147200, 256},
    {"model.layers.19.self_attn.k_proj.weight", 7036147456, 8388608},
    {"model.layers.19.self_attn.o_proj.weight", 7044536064, 33554432},
    {"model.layers.19.self_attn.q_norm.weight", 7078090496, 256},
    {"model.layers.19.self_attn.q_proj.weight", 7078090752, 33554432},
    {"model.layers.19.self_attn.v_proj.weight", 7111645184, 8388608},
    {"model.layers.2.input_layernorm.weight", 7120033792, 8192},
    {"model.layers.2.mlp.down_proj.weight", 7120041984, 100663296},
    {"model.layers.2.mlp.gate_proj.weight", 7220705280, 100663296},
    {"model.layers.2.mlp.up_proj.weight", 7321368576, 100663296},
    {"model.layers.2.post_attention_layernorm.weight", 7422031872, 8192},
    {"model.layers.2.self_attn.k_norm.weight", 7422040064, 256},
    {"model.layers.2.self_attn.k_proj.weight", 7422040320, 8388608},
    {"model.layers.2.self_attn.o_proj.weight", 7430428928, 33554432},
    {"model.layers.2.self_attn.q_norm.weight", 7463983360, 256},
    {"model.layers.2.self_attn.q_proj.weight", 7463983616, 33554432},
    {"model.layers.2.self_attn.v_proj.weight", 7497538048, 8388608},
    {"model.layers.20.input_layernorm.weight", 7505926656, 8192},
    {"model.layers.20.mlp.down_proj.weight", 7505934848, 100663296},
    {"model.layers.20.mlp.gate_proj.weight", 7606598144, 100663296},
    {"model.layers.20.mlp.up_proj.weight", 7707261440, 100663296},
    {"model.layers.20.post_attention_layernorm.weight", 7807924736, 8192},
    {"model.layers.20.self_attn.k_norm.weight", 7807932928, 256},
    {"model.layers.20.self_attn.k_proj.weight", 7807933184, 8388608},
    {"model.layers.20.self_attn.o_proj.weight", 7816321792, 33554432},
    {"model.layers.20.self_attn.q_norm.weight", 7849876224, 256},
    {"model.layers.20.self_attn.q_proj.weight", 7849876480, 33554432},
    {"model.layers.20.self_attn.v_proj.weight", 7883430912, 8388608},
    {"model.layers.21.input_layernorm.weight", 7891819520, 8192},
    {"model.layers.21.mlp.down_proj.weight", 7891827712, 100663296},
    {"model.layers.21.mlp.gate_proj.weight", 7992491008, 100663296},
    {"model.layers.21.mlp.up_proj.weight", 8093154304, 100663296},
    {"model.layers.21.post_attention_layernorm.weight", 8193817600, 8192},
    {"model.layers.21.self_attn.k_norm.weight", 8193825792, 256},
    {"model.layers.21.self_attn.k_proj.weight", 8193826048, 8388608},
    {"model.layers.21.self_attn.o_proj.weight", 8202214656, 33554432},
    {"model.layers.21.self_attn.q_norm.weight", 8235769088, 256},
    {"model.layers.21.self_attn.q_proj.weight", 8235769344, 33554432},
    {"model.layers.21.self_attn.v_proj.weight", 8269323776, 8388608},
    {"model.layers.22.input_layernorm.weight", 8277712384, 8192},
    {"model.layers.22.mlp.down_proj.weight", 8277720576, 100663296},
    {"model.layers.22.mlp.gate_proj.weight", 8378383872, 100663296},
    {"model.layers.22.mlp.up_proj.weight", 8479047168, 100663296},
    {"model.layers.22.post_attention_layernorm.weight", 8579710464, 8192},
    {"model.layers.22.self_attn.k_norm.weight", 8579718656, 256},
    {"model.layers.22.self_attn.k_proj.weight", 8579718912, 8388608},
    {"model.layers.22.self_attn.o_proj.weight", 8588107520, 33554432},
    {"model.layers.22.self_attn.q_norm.weight", 8621661952, 256},
    {"model.layers.22.self_attn.q_proj.weight", 8621662208, 33554432},
    {"model.layers.22.self_attn.v_proj.weight", 8655216640, 8388608},
    {"model.layers.23.input_layernorm.weight", 8663605248, 8192},
    {"model.layers.23.mlp.down_proj.weight", 8663613440, 100663296},
    {"model.layers.23.mlp.gate_proj.weight", 8764276736, 100663296},
    {"model.layers.23.mlp.up_proj.weight", 8864940032, 100663296},
    {"model.layers.23.post_attention_layernorm.weight", 8965603328, 8192},
    {"model.layers.23.self_attn.k_norm.weight", 8965611520, 256},
    {"model.layers.23.self_attn.k_proj.weight", 8965611776, 8388608},
    {"model.layers.23.self_attn.o_proj.weight", 8974000384, 33554432},
    {"model.layers.23.self_attn.q_norm.weight", 9007554816, 256},
    {"model.layers.23.self_attn.q_proj.weight", 9007555072, 33554432},
    {"model.layers.23.self_attn.v_proj.weight", 9041109504, 8388608},
    {"model.layers.24.input_layernorm.weight", 9049498112, 8192},
    {"model.layers.24.mlp.down_proj.weight", 9049506304, 100663296},
    {"model.layers.24.mlp.gate_proj.weight", 9150169600, 100663296},
    {"model.layers.24.mlp.up_proj.weight", 9250832896, 100663296},
    {"model.layers.24.post_attention_layernorm.weight", 9351496192, 8192},
    {"model.layers.24.self_attn.k_norm.weight", 9351504384, 256},
    {"model.layers.24.self_attn.k_proj.weight", 9351504640, 8388608},
    {"model.layers.24.self_attn.o_proj.weight", 9359893248, 33554432},
    {"model.layers.24.self_attn.q_norm.weight", 9393447680, 256},
    {"model.layers.24.self_attn.q_proj.weight", 9393447936, 33554432},
    {"model.layers.24.self_attn.v_proj.weight", 9427002368, 8388608},
    {"model.layers.25.input_layernorm.weight", 9435390976, 8192},
    {"model.layers.25.mlp.down_proj.weight", 9435399168, 100663296},
    {"model.layers.25.mlp.gate_proj.weight", 9536062464, 100663296},
    {"model.layers.25.mlp.up_proj.weight", 9636725760, 100663296},
    {"model.layers.25.post_attention_layernorm.weight", 9737389056, 8192},
    {"model.layers.25.self_attn.k_norm.weight", 9737397248, 256},
    {"model.layers.25.self_attn.k_proj.weight", 9737397504, 8388608},
    {"model.layers.25.self_attn.o_proj.weight", 9745786112, 33554432},
    {"model.layers.25.self_attn.q_norm.weight", 9779340544, 256},
    {"model.layers.25.self_attn.q_proj.weight", 9779340800, 33554432},
    {"model.layers.25.self_attn.v_proj.weight", 9812895232, 8388608},
    {"model.layers.26.input_layernorm.weight", 9821283840, 8192},
    {"model.layers.26.mlp.down_proj.weight", 9821292032, 100663296},
    {"model.layers.26.mlp.gate_proj.weight", 9921955328, 100663296},
    {"model.layers.26.mlp.up_proj.weight", 10022618624, 100663296},
    {"model.layers.26.post_attention_layernorm.weight", 10123281920, 8192},
    {"model.layers.26.self_attn.k_norm.weight", 10123290112, 256},
    {"model.layers.26.self_attn.k_proj.weight", 10123290368, 8388608},
    {"model.layers.26.self_attn.o_proj.weight", 10131678976, 33554432},
    {"model.layers.26.self_attn.q_norm.weight", 10165233408, 256},
    {"model.layers.26.self_attn.q_proj.weight", 10165233664, 33554432},
    {"model.layers.26.self_attn.v_proj.weight", 10198788096, 8388608},
    {"model.layers.27.input_layernorm.weight", 10207176704, 8192},
    {"model.layers.27.mlp.down_proj.weight", 10207184896, 100663296},
    {"model.layers.27.mlp.gate_proj.weight", 10307848192, 100663296},
    {"model.layers.27.mlp.up_proj.weight", 10408511488, 100663296},
    {"model.layers.27.post_attention_layernorm.weight", 10509174784, 8192},
    {"model.layers.27.self_attn.k_norm.weight", 10509182976, 256},
    {"model.layers.27.self_attn.k_proj.weight", 10509183232, 8388608},
    {"model.layers.27.self_attn.o_proj.weight", 10517571840, 33554432},
    {"model.layers.27.self_attn.q_norm.weight", 10551126272, 256},
    {"model.layers.27.self_attn.q_proj.weight", 10551126528, 33554432},
    {"model.layers.27.self_attn.v_proj.weight", 10584680960, 8388608},
    {"model.layers.28.input_layernorm.weight", 10593069568, 8192},
    {"model.layers.28.mlp.down_proj.weight", 10593077760, 100663296},
    {"model.layers.28.mlp.gate_proj.weight", 10693741056, 100663296},
    {"model.layers.28.mlp.up_proj.weight", 10794404352, 100663296},
    {"model.layers.28.post_attention_layernorm.weight", 10895067648, 8192},
    {"model.layers.28.self_attn.k_norm.weight", 10895075840, 256},
    {"model.layers.28.self_attn.k_proj.weight", 10895076096, 8388608},
    {"model.layers.28.self_attn.o_proj.weight", 10903464704, 33554432},
    {"model.layers.28.self_attn.q_norm.weight", 10937019136, 256},
    {"model.layers.28.self_attn.q_proj.weight", 10937019392, 33554432},
    {"model.layers.28.self_attn.v_proj.weight", 10970573824, 8388608},
    {"model.layers.29.input_layernorm.weight", 10978962432, 8192},
    {"model.layers.29.mlp.down_proj.weight", 10978970624, 100663296},
    {"model.layers.29.mlp.gate_proj.weight", 11079633920, 100663296},
    {"model.layers.29.mlp.up_proj.weight", 11180297216, 100663296},
    {"model.layers.29.post_attention_layernorm.weight", 11280960512, 8192},
    {"model.layers.29.self_attn.k_norm.weight", 11280968704, 256},
    {"model.layers.29.self_attn.k_proj.weight", 11280968960, 8388608},
    {"model.layers.29.self_attn.o_proj.weight", 11289357568, 33554432},
    {"model.layers.29.self_attn.q_norm.weight", 11322912000, 256},
    {"model.layers.29.self_attn.q_proj.weight", 11322912256, 33554432},
    {"model.layers.29.self_attn.v_proj.weight", 11356466688, 8388608},
    {"model.layers.3.input_layernorm.weight", 11364855296, 8192},
    {"model.layers.3.mlp.down_proj.weight", 11364863488, 100663296},
    {"model.layers.3.mlp.gate_proj.weight", 11465526784, 100663296},
    {"model.layers.3.mlp.up_proj.weight", 11566190080, 100663296},
    {"model.layers.3.post_attention_layernorm.weight", 11666853376, 8192},
    {"model.layers.3.self_attn.k_norm.weight", 11666861568, 256},
    {"model.layers.3.self_attn.k_proj.weight", 11666861824, 8388608},
    {"model.layers.3.self_attn.o_proj.weight", 11675250432, 33554432},
    {"model.layers.3.self_attn.q_norm.weight", 11708804864, 256},
    {"model.layers.3.self_attn.q_proj.weight", 11708805120, 33554432},
    {"model.layers.3.self_attn.v_proj.weight", 11742359552, 8388608},
    {"model.layers.30.input_layernorm.weight", 11750748160, 8192},
    {"model.layers.30.mlp.down_proj.weight", 11750756352, 100663296},
    {"model.layers.30.mlp.gate_proj.weight", 11851419648, 100663296},
    {"model.layers.30.mlp.up_proj.weight", 11952082944, 100663296},
    {"model.layers.30.post_attention_layernorm.weight", 12052746240, 8192},
    {"model.layers.30.self_attn.k_norm.weight", 12052754432, 256},
    {"model.layers.30.self_attn.k_proj.weight", 12052754688, 8388608},
    {"model.layers.30.self_attn.o_proj.weight", 12061143296, 33554432},
    {"model.layers.30.self_attn.q_norm.weight", 12094697728, 256},
    {"model.layers.30.self_attn.q_proj.weight", 12094697984, 33554432},
    {"model.layers.30.self_attn.v_proj.weight", 12128252416, 8388608},
    {"model.layers.31.input_layernorm.weight", 12136641024, 8192},
    {"model.layers.31.mlp.down_proj.weight", 12136649216, 100663296},
    {"model.layers.31.mlp.gate_proj.weight", 12237312512, 100663296},
    {"model.layers.31.mlp.up_proj.weight", 12337975808, 100663296},
    {"model.layers.31.post_attention_layernorm.weight", 12438639104, 8192},
    {"model.layers.31.self_attn.k_norm.weight", 12438647296, 256},
    {"model.layers.31.self_attn.k_proj.weight", 12438647552, 8388608},
    {"model.layers.31.self_attn.o_proj.weight", 12447036160, 33554432},
    {"model.layers.31.self_attn.q_norm.weight", 12480590592, 256},
    {"model.layers.31.self_attn.q_proj.weight", 12480590848, 33554432},
    {"model.layers.31.self_attn.v_proj.weight", 12514145280, 8388608},
    {"model.layers.32.input_layernorm.weight", 12522533888, 8192},
    {"model.layers.32.mlp.down_proj.weight", 12522542080, 100663296},
    {"model.layers.32.mlp.gate_proj.weight", 12623205376, 100663296},
    {"model.layers.32.mlp.up_proj.weight", 12723868672, 100663296},
    {"model.layers.32.post_attention_layernorm.weight", 12824531968, 8192},
    {"model.layers.32.self_attn.k_norm.weight", 12824540160, 256},
    {"model.layers.32.self_attn.k_proj.weight", 12824540416, 8388608},
    {"model.layers.32.self_attn.o_proj.weight", 12832929024, 33554432},
    {"model.layers.32.self_attn.q_norm.weight", 12866483456, 256},
    {"model.layers.32.self_attn.q_proj.weight", 12866483712, 33554432},
    {"model.layers.32.self_attn.v_proj.weight", 12900038144, 8388608},
    {"model.layers.33.input_layernorm.weight", 12908426752, 8192},
    {"model.layers.33.mlp.down_proj.weight", 12908434944, 100663296},
    {"model.layers.33.mlp.gate_proj.weight", 13009098240, 100663296},
    {"model.layers.33.mlp.up_proj.weight", 13109761536, 100663296},
    {"model.layers.33.post_attention_layernorm.weight", 13210424832, 8192},
    {"model.layers.33.self_attn.k_norm.weight", 13210433024, 256},
    {"model.layers.33.self_attn.k_proj.weight", 13210433280, 8388608},
    {"model.layers.33.self_attn.o_proj.weight", 13218821888, 33554432},
    {"model.layers.33.self_attn.q_norm.weight", 13252376320, 256},
    {"model.layers.33.self_attn.q_proj.weight", 13252376576, 33554432},
    {"model.layers.33.self_attn.v_proj.weight", 13285931008, 8388608},
    {"model.layers.34.input_layernorm.weight", 13294319616, 8192},
    {"model.layers.34.mlp.down_proj.weight", 13294327808, 100663296},
    {"model.layers.34.mlp.gate_proj.weight", 13394991104, 100663296},
    {"model.layers.34.mlp.up_proj.weight", 13495654400, 100663296},
    {"model.layers.34.post_attention_layernorm.weight", 13596317696, 8192},
    {"model.layers.34.self_attn.k_norm.weight", 13596325888, 256},
    {"model.layers.34.self_attn.k_proj.weight", 13596326144, 8388608},
    {"model.layers.34.self_attn.o_proj.weight", 13604714752, 33554432},
    {"model.layers.34.self_attn.q_norm.weight", 13638269184, 256},
    {"model.layers.34.self_attn.q_proj.weight", 13638269440, 33554432},
    {"model.layers.34.self_attn.v_proj.weight", 13671823872, 8388608},
    {"model.layers.35.input_layernorm.weight", 13680212480, 8192},
    {"model.layers.35.mlp.down_proj.weight", 13680220672, 100663296},
    {"model.layers.35.mlp.gate_proj.weight", 13780883968, 100663296},
    {"model.layers.35.mlp.up_proj.weight", 13881547264, 100663296},
    {"model.layers.35.post_attention_layernorm.weight", 13982210560, 8192},
    {"model.layers.35.self_attn.k_norm.weight", 13982218752, 256},
    {"model.layers.35.self_attn.k_proj.weight", 13982219008, 8388608},
    {"model.layers.35.self_attn.o_proj.weight", 13990607616, 33554432},
    {"model.layers.35.self_attn.q_norm.weight", 14024162048, 256},
    {"model.layers.35.self_attn.q_proj.weight", 14024162304, 33554432},
    {"model.layers.35.self_attn.v_proj.weight", 14057716736, 8388608},
    {"model.layers.4.input_layernorm.weight", 14066105344, 8192},
    {"model.layers.4.mlp.down_proj.weight", 14066113536, 100663296},
    {"model.layers.4.mlp.gate_proj.weight", 14166776832, 100663296},
    {"model.layers.4.mlp.up_proj.weight", 14267440128, 100663296},
    {"model.layers.4.post_attention_layernorm.weight", 14368103424, 8192},
    {"model.layers.4.self_attn.k_norm.weight", 14368111616, 256},
    {"model.layers.4.self_attn.k_proj.weight", 14368111872, 8388608},
    {"model.layers.4.self_attn.o_proj.weight", 14376500480, 33554432},
    {"model.layers.4.self_attn.q_norm.weight", 14410054912, 256},
    {"model.layers.4.self_attn.q_proj.weight", 14410055168, 33554432},
    {"model.layers.4.self_attn.v_proj.weight", 14443609600, 8388608},
    {"model.layers.5.input_layernorm.weight", 14451998208, 8192},
    {"model.layers.5.mlp.down_proj.weight", 14452006400, 100663296},
    {"model.layers.5.mlp.gate_proj.weight", 14552669696, 100663296},
    {"model.layers.5.mlp.up_proj.weight", 14653332992, 100663296},
    {"model.layers.5.post_attention_layernorm.weight", 14753996288, 8192},
    {"model.layers.5.self_attn.k_norm.weight", 14754004480, 256},
    {"model.layers.5.self_attn.k_proj.weight", 14754004736, 8388608},
    {"model.layers.5.self_attn.o_proj.weight", 14762393344, 33554432},
    {"model.layers.5.self_attn.q_norm.weight", 14795947776, 256},
    {"model.layers.5.self_attn.q_proj.weight", 14795948032, 33554432},
    {"model.layers.5.self_attn.v_proj.weight", 14829502464, 8388608},
    {"model.layers.6.input_layernorm.weight", 14837891072, 8192},
    {"model.layers.6.mlp.down_proj.weight", 14837899264, 100663296},
    {"model.layers.6.mlp.gate_proj.weight", 14938562560, 100663296},
    {"model.layers.6.mlp.up_proj.weight", 15039225856, 100663296},
    {"model.layers.6.post_attention_layernorm.weight", 15139889152, 8192},
    {"model.layers.6.self_attn.k_norm.weight", 15139897344, 256},
    {"model.layers.6.self_attn.k_proj.weight", 15139897600, 8388608},
    {"model.layers.6.self_attn.o_proj.weight", 15148286208, 33554432},
    {"model.layers.6.self_attn.q_norm.weight", 15181840640, 256},
    {"model.layers.6.self_attn.q_proj.weight", 15181840896, 33554432},
    {"model.layers.6.self_attn.v_proj.weight", 15215395328, 8388608},
    {"model.layers.7.input_layernorm.weight", 15223783936, 8192},
    {"model.layers.7.mlp.down_proj.weight", 15223792128, 100663296},
    {"model.layers.7.mlp.gate_proj.weight", 15324455424, 100663296},
    {"model.layers.7.mlp.up_proj.weight", 15425118720, 100663296},
    {"model.layers.7.post_attention_layernorm.weight", 15525782016, 8192},
    {"model.layers.7.self_attn.k_norm.weight", 15525790208, 256},
    {"model.layers.7.self_attn.k_proj.weight", 15525790464, 8388608},
    {"model.layers.7.self_attn.o_proj.weight", 15534179072, 33554432},
    {"model.layers.7.self_attn.q_norm.weight", 15567733504, 256},
    {"model.layers.7.self_attn.q_proj.weight", 15567733760, 33554432},
    {"model.layers.7.self_attn.v_proj.weight", 15601288192, 8388608},
    {"model.layers.8.input_layernorm.weight", 15609676800, 8192},
    {"model.layers.8.mlp.down_proj.weight", 15609684992, 100663296},
    {"model.layers.8.mlp.gate_proj.weight", 15710348288, 100663296},
    {"model.layers.8.mlp.up_proj.weight", 15811011584, 100663296},
    {"model.layers.8.post_attention_layernorm.weight", 15911674880, 8192},
    {"model.layers.8.self_attn.k_norm.weight", 15911683072, 256},
    {"model.layers.8.self_attn.k_proj.weight", 15911683328, 8388608},
    {"model.layers.8.self_attn.o_proj.weight", 15920071936, 33554432},
    {"model.layers.8.self_attn.q_norm.weight", 15953626368, 256},
    {"model.layers.8.self_attn.q_proj.weight", 15953626624, 33554432},
    {"model.layers.8.self_attn.v_proj.weight", 15987181056, 8388608},
    {"model.layers.9.input_layernorm.weight", 15995569664, 8192},
    {"model.layers.9.mlp.down_proj.weight", 15995577856, 100663296},
    {"model.layers.9.mlp.gate_proj.weight", 16096241152, 100663296},
    {"model.layers.9.mlp.up_proj.weight", 16196904448, 100663296},
    {"model.layers.9.post_attention_layernorm.weight", 16297567744, 8192},
    {"model.layers.9.self_attn.k_norm.weight", 16297575936, 256},
    {"model.layers.9.self_attn.k_proj.weight", 16297576192, 8388608},
    {"model.layers.9.self_attn.o_proj.weight", 16305964800, 33554432},
    {"model.layers.9.self_attn.q_norm.weight", 16339519232, 256},
    {"model.layers.9.self_attn.q_proj.weight", 16339519488, 33554432},
    {"model.layers.9.self_attn.v_proj.weight", 16373073920, 8388608},
    {"model.norm.weight", 16381462528, 8192},
};

Weights load_weights(const char* filepath) {
    Weights weights;

    // step 1: Memory map the safetensors file
    int fd = open(filepath, O_RDONLY);
    if (fd == -1) { 
        printf("Failed to open file.");
        exit(-1);
    }

    struct stat file_stat;
    if (fstat(fd, &file_stat) == -1)
    {
        close(fd);
        printf("Failed to get file stats.");
        exit(-1);
    }
    size_t file_size = file_stat.st_size;

    uint64_t json_header_len;
    if (pread(fd, &json_header_len, 8, 0) != 8)
    {
        close(fd);
        printf("Failed to read safetensors header length.");
        exit(-1);
    }
    const size_t data_start_offset = 8 + json_header_len;

    char* mapped_file = (char*)mmap(NULL, file_size, PROT_READ, MAP_PRIVATE, fd, 0);
    if (mapped_file == MAP_FAILED)
    {
        close(fd);
        printf("Failed to mmap file.");
        exit(-1);
    }
    close(fd);

    char* data_ptr = mapped_file + data_start_offset;

    // step 2: allocate one giant block on the GPU
    printf("Allocating memory on GPU");
    CUDA_CHECK(cudaMalloc(&weights.gpu_mem_block, TOTAL_WEIGHTS_BYTES));
    char* all_weights_gpu = (char*)weights.gpu_mem_block;
    
    // step 3: copy each tensor from mmap'd memory to the GPU
    cudaStream_t stream;
    CUDA_CHECK(cudaStreamCreate(&stream));
    for (int i = 0; i < NUM_TENSORS; ++i)
    {
        printf("Copying tensor %d to GPU\n", i);
        const TensorMetadata meta = TENSOR_METADATA[i];
        void* gpu_target_ptr = all_weights_gpu + meta.offset;
        char* host_source_ptr = data_ptr + meta.offset;
        CUDA_CHECK(cudaMemcpyAsync(gpu_target_ptr, host_source_ptr, meta.size_bytes, cudaMemcpyHostToDevice, stream));
    }
    CUDA_CHECK(cudaStreamSynchronize(stream));
    CUDA_CHECK(cudaStreamDestroy(stream));

    munmap(mapped_file, file_size);

    // step 4: assign the pointers in our C++ struct (zero-cost)
    weights.lm_head     = (__nv_bfloat16_raw*)(all_weights_gpu + TENSOR_METADATA[0].offset);
    weights.embedding   = (__nv_bfloat16_raw*)(all_weights_gpu + TENSOR_METADATA[1].offset);
    weights.norm        = (__nv_bfloat16_raw*)(all_weights_gpu + TENSOR_METADATA[NUM_TENSORS - 1].offset);

    // safetensors file does not store layers sequentially
    const int tensors_per_layer = 11;
    // qwen 0.6b
    // const int layer_map[NUM_HIDDEN_LAYERS] = {0, 1, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 2, 20, 21, 22, 23, 24, 25, 26, 27, 3, 4, 5, 6, 7, 8, 9};

    // qwen 8b
    const int layer_map[NUM_HIDDEN_LAYERS] = {0, 1, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 2, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 3, 30, 31, 32, 33, 34, 35, 4, 5, 6, 7, 8, 9};
    
    // layer weights start at index 2 in the TENSOR_METADATA array
    int current_tensor_idx_offset = 2;

    for (uint32_t i = 0; i < NUM_HIDDEN_LAYERS; ++i)
    {
        int layer_idx = layer_map[i];
        int start_idx = current_tensor_idx_offset + i * tensors_per_layer;
        
        TransformerBlock* layer = &(weights.transformer_blocks[layer_idx]);
        layer->input_layernorm          = (__nv_bfloat16_raw*)(all_weights_gpu + TENSOR_METADATA[start_idx + 0].offset);
        layer->ffn.down_proj            = (__nv_bfloat16_raw*)(all_weights_gpu + TENSOR_METADATA[start_idx + 1].offset);
        layer->ffn.gate_proj            = (__nv_bfloat16_raw*)(all_weights_gpu + TENSOR_METADATA[start_idx + 2].offset);
        layer->ffn.up_proj              = (__nv_bfloat16_raw*)(all_weights_gpu + TENSOR_METADATA[start_idx + 3].offset);
        layer->post_attention_layernorm = (__nv_bfloat16_raw*)(all_weights_gpu + TENSOR_METADATA[start_idx + 4].offset);
        layer->attention.k_norm         = (__nv_bfloat16_raw*)(all_weights_gpu + TENSOR_METADATA[start_idx + 5].offset);
        layer->attention.k_proj         = (__nv_bfloat16_raw*)(all_weights_gpu + TENSOR_METADATA[start_idx + 6].offset);
        layer->attention.o_proj         = (__nv_bfloat16_raw*)(all_weights_gpu + TENSOR_METADATA[start_idx + 7].offset);
        layer->attention.q_norm         = (__nv_bfloat16_raw*)(all_weights_gpu + TENSOR_METADATA[start_idx + 8].offset);
        layer->attention.q_proj         = (__nv_bfloat16_raw*)(all_weights_gpu + TENSOR_METADATA[start_idx + 9].offset);
        layer->attention.v_proj         = (__nv_bfloat16_raw*)(all_weights_gpu + TENSOR_METADATA[start_idx + 10].offset);
    }

    return weights;
}
